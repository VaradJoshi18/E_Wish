{% load static %}
<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Shop</title>
    <link rel="stylesheet" href="static/css/index.css">
</head>
<body>
    {% if messages %}
        {% for message in messages %}
            {% if message.tags %}  <script>alert("{{ message }}")</script> {% endif %}
        {% endfor %}
    {% endif %}

<!-- Start Main Top -->
    {% include 'header.html' %}
<!-- End Main Top -->

    <section class="contact_section">
        <h1>SHOP</h1>
        <hr class="smallline2"> 
        <h5>Get your grocery items with ease!</h5>
        
        {% for data in product %} 
        <div class="row">
            <div class="column">
                <div class="product-card">
                    <div class="badge"><p>{{data.average_rating}}*</p></div>
                    <div class="product-tumb">
                        {% if data.productImage %}
                            <img src="{{ data.productImage.url }}" alt="">
                        {% else %}
                            <img src="{% static 'images/noimage.png' %}"  alt="" class="prod-size">
                        {% endif %}  
                    </div>
                    <div class="product-details">
                        <span class="product-catagory" align="right" >{{data.dietType}}</span>
                        <span class="product-catagory">{{data.categoryName.categoryName}}</span>
                        <h2>{{data.productName}}</h2>
                        <p>{{data.productDesc}}</p>
                        <div class="product-bottom-details">
                            <div class="product-price"><small>$96.00</small>{{data.productPrice}}</div>
                        </div>
                    </div>
                </div>
            </div>
        </form>
        {% endfor %}
        </div><br>
    </section>
    <script>
        // Get all the increment buttons and add a click event listener to each one
        var incrementButtons = document.querySelectorAll(".incr-btn");
        incrementButtons.forEach(function (button) {
            button.addEventListener("click", function () {
                // Get the ID of the product associated with this increment button
                var productId = this.dataset.productId;

                // Get the input element for the product with this ID
                var quantityInput = document.querySelector("#quantity-" + productId);

                // Get the current value of the input element and increment it
                var currentValue = parseInt(quantityInput.value);
                var newValue = currentValue + 1;

                // Update the input element with the new value
                quantityInput.value = newValue;

                // Get the price element for the product with this ID
                var priceElement = document.querySelector("#product-price-" + productId);

                // Get the current price of the product and update it based on the new quantity
                var currentPrice = parseFloat(priceElement.innerText.replace("₹", ""));
                var newPrice = (currentPrice / currentValue) * newValue;

                // Update the price element with the new price, rounded to 2 decimal places
                priceElement.innerText = "₹" + newPrice.toFixed(2);
            });
        });

        // Get all the decrement buttons and add a click event listener to each one
        var decrementButtons = document.querySelectorAll(".decr-btn");
        decrementButtons.forEach(function (button) {
            button.addEventListener("click", function () {
                // Get the ID of the product associated with this decrement button
                var productId = this.dataset.productId;

                // Get the input element for the product with this ID
                var quantityInput = document.querySelector("#quantity-" + productId);

                // Get the current value of the input element and decrement it
                var currentValue = parseInt(quantityInput.value);
                var newValue = currentValue - 1;

                // Make sure the new value is not less than 1
                if (newValue < 1) {
                    newValue = 1;
                } 

                // Update the input element with the new value
                quantityInput.value = newValue;

                // Get the price element for the product with this ID
                var priceElement = document.querySelector("#product-price-" + productId);

                // Get the current price of the product and update it based on the new quantity
                var currentPrice = parseFloat(priceElement.innerText.replace("₹", ""));
                var newPrice = (currentPrice / currentValue) * newValue;

                // Update the price element with the new price, rounded to 2 decimal places
                priceElement.innerText = "₹" + newPrice.toFixed(2);
            });
        });

    </script>        
</body>
</html>